<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Website Description"><title>Deploying This Site to Github Pages - Introduction</title><meta property="og:title" content="Deploying This Site to Github Pages - Introduction"><meta property="og:type" content="website"><meta property="og:description" content="Website Description"><meta property="og:url" content="/blog/start/start/"><meta property="og:site_name" content="Introduction"><meta property="og:image" content="/home/profile.jpg"><link rel="shortcut icon" href=/img/fav.ico><link rel=stylesheet href=/css/main.min.c00d86df52e3ca2e95125d6794e6bb18a97620f7585e99756c3d46c139a20077.css integrity="sha256-wA2G31Ljyi6VEl1nlOa7GKl2IPdYXpl1bD1GwTmiAHc=" crossorigin=anonymous media=screen><link rel=stylesheet href=/buttons.css integrity crossorigin=anonymous media=screen></head><body><section id=top class=section><div class="container hero fade-in one"><h1 class="bold-title is-1">Blog</h1></div><div class="section fade-in two"><div class=container><hr><nav class=navbar role=navigation aria-label="main navigation"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><div class=navbar-menu id=navMenu><a class=navbar-item href=/>Home</a>
<a class=navbar-item href=/#about>About</a>
<a class=navbar-item href=/#skills>Skills</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/#contact>Contact</a></div></nav><hr></div><div class=container><h2 class="title is-1 top-pad strong-post-title"><a href=/blog/start/start/>Deploying This Site to Github Pages</a></h2><div class=post-data>Oct 19, 2020 |
6 minutes read</div><div class=blog-share>Share this:
<a class=twitter-share-button href="https://twitter.com/intent/tweet?text=Deploying%20This%20Site%20to%20Github%20Pages%20%2fblog%2fstart%2fstart%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fab fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=%2fblog%2fstart%2fstart%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fab fa-facebook-f"></i><span class=hidden>Facebook</span></a>
<a class=icon-pinterest href="http://pinterest.com/pin/create/button/?url=%2fblog%2fstart%2fstart%2f&description=Deploying%20This%20Site%20to%20Github%20Pages" onclick="window.open(this.href,'pinterest-share','width=580,height=296');return false;"><i class="fab fa-pinterest-p"></i><span class=hidden>Pinterest</span></a>
<a class=icon-google-plus href="https://plus.google.com/share?url=%2fblog%2fstart%2fstart%2f" onclick="window.open(this.href,'google-plus-share','width=490,height=530');return false;"><i class="fab fa-google-plus-g"></i><span class=hidden>Google+</span></a></div><p>Tags:
<a href=/tags/actions>Actions</a>,
<a href=/tags/hugo>Hugo</a>,
<a href=/tags/github>Github</a></p></div><div class="container markdown top-pad"><h2 id=the-start-of-this-site class=anchor-link><a href=#the-start-of-this-site>The Start of this Site</a></h2><p>A while ago I joined a lot of developer and tech communities and noticed that there&rsquo;s a lot of people building really nice personal websites, so I thought I should probably do the same. I&rsquo;ve never been a super creative or visual person and have carved out my career as more of a backend engineer. So I decided to go with a static site generator and had some familiarity with Hugo. I poked around a bunch of hugo themes and eventually found <a href=https://themes.gohugo.io/hugo-theme-introduction/>this somewhat minimalist theme</a> that really sparked an interest in me. So I went ahead and downloaded it and set up my initial website. I did somewhat edit the theme to add the skills section you see <a href=https://brentgruber.github.io/#skills>here</a> and also to add the download resume button directly under my beautiful mug. you can find all the edits under /themes/introduction/layouts in the source repository <a href=https://github.com/BrentGruber/BrentGruber.github.io/tree/master/themes/introduction/layouts>here</a></p><h2 id=initial-deployment class=anchor-link><a href=#initial-deployment>Initial Deployment</a></h2><p>Now that I had a basic site with all my information filled in I needed a way to deploy it and share it with the world. I examined a couple options to start with</p><ol><li><p>Github Pages</p></li><li><p>A droplet on digital ocean with nginx or a similar reverse proxy software</p></li><li><p>Self hosting</p></li></ol><p>At the time I first started working on the website I had a slight obsession with trying to host everything myself on my own hardware. So I decided to light a candle with a flamethrower and host my own gitlab server.</p><p>I went ahead and set aside some resources on my overpowered gaming desktop and provisioned a 2x4 ubuntu vm using Windows Hyper-V. I set gitlab up, set up a runner for the gitlab CI, and set up a workflow for my repo. I got my first successful workflow and deploy to my local gitlab pages, but now I just needed a way to expose the site to the internet. I provisioned a <a href=https://m.do.co/c/ab7362a9821f>Digital Ocean*</a> droplet and installed Caddy on it with the intention to use it as a reverse proxy into the gitlab pages site running on my vm. I was able to do this by connecting both the droplet and the vm to a wireguard network and setting up caddy to reverse proxy my subdomain (portfolio.brentgruber.com) to the vm on my home network. Bonus points because Caddy provided https by default. Everything worked great!</p><p><img src=/blog/start/success.jpeg alt=success></p><h2 id=until class=anchor-link><a href=#until>Until&mldr;</a></h2><p>The power went out in the house and I don&rsquo;t happen to have a UPS for my desktop or modem. The power eventually came back on, and gitlab came right back up thanks to the power of systemd, but I realized that my site was unavailable for a few hours. What if someone was looking for my site at that moment looking to give away a million dollars. I simply can not allow that. I also noticed when the vm came back online that I had the memory usage set to dynamic and the gitlab vm was eating up 10-12gb of ram regularly, which was way too resource heavy for my liking, considering at this point I was pretty much only using it for a static site.</p><h2 id=intro-github-actions class=anchor-link><a href=#intro-github-actions>Intro Github Actions</a></h2><p>I decided to revisit if it was worth trying to self host this site and how much work it would take to build resiliency. So Github it was. I already had the site done, so all I really needed to do was translate my gitlab-ci.yml file to a github actions workflow yaml file. after a little debugging I ended up with the file below, it does a handful of things.</p><ol><li>the on field dictates that it will begin executing any time there is a push to the master branch</li><li>When it executes it will run a single job named deploy, what this job does is as follows:</li><li>checks out the repo</li><li>Installs Hugo Extended</li><li>Installs NodeJS and runs an npm install to apply the dependencies in the package.json</li><li>Caches the npm dependencies</li><li>runs &ldquo;npm ci&rdquo; to install the project with a clean slate</li><li>runs hugo to build the project, which places the built site in a /public directory, note that the &ndash;minify flag just minimizes the final output and removes any unneeded or redundant lines</li><li>It deploys it to github pages!</li></ol><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>github pages<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#062873;font-weight:700>on</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#062873;font-weight:700>push</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#062873;font-weight:700>branches</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- master  # Set a branch to deploy<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#062873;font-weight:700>jobs</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#062873;font-weight:700>deploy</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#062873;font-weight:700>runs-on</span>:<span style=color:#bbb> </span>ubuntu-18.04<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#062873;font-weight:700>steps</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#062873;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>submodules</span>:<span style=color:#bbb> </span>recursive  # Fetch the theme<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>fetch-depth</span>:<span style=color:#bbb> </span><span style=color:#40a070>0</span><span style=color:#bbb>         </span><span style=color:#60a0b0;font-style:italic># Fetch all history for .GitInfo and .Lastmod</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>Setup Hugo<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>uses</span>:<span style=color:#bbb> </span>peaceiris/actions-hugo@v2<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>hugo-version</span>:<span style=color:#bbb> </span><span style=color:#4070a0>&#39;0.75.1&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>extended</span>:<span style=color:#bbb> </span><span style=color:#007020;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>Setup Node<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/setup-node@v1<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>node-version</span>:<span style=color:#bbb> </span><span style=color:#4070a0>&#39;12.x&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>Cache dependencies<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/cache@v1<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>path</span>:<span style=color:#bbb> </span>~/.npm<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>key</span>:<span style=color:#bbb> </span>${{ runner.os }}-node-${{ hashFiles(&#39;**/package-lock.json&#39;) }}<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>restore-keys</span>:<span style=color:#bbb> </span><span style=color:#4070a0;font-style:italic>|
</span><span style=color:#4070a0;font-style:italic>            ${{ runner.os }}-node-
</span><span style=color:#4070a0;font-style:italic>
</span><span style=color:#4070a0;font-style:italic>      - run: npm ci
</span><span style=color:#4070a0;font-style:italic>      - run: hugo --minify
</span><span style=color:#4070a0;font-style:italic>
</span><span style=color:#4070a0;font-style:italic>      - name: Deploy
</span><span style=color:#4070a0;font-style:italic>        uses: peaceiris/actions-gh-pages@v3
</span><span style=color:#4070a0;font-style:italic>        with:
</span><span style=color:#4070a0;font-style:italic>          github_token: ${{ secrets.GITHUB_TOKEN }}
</span><span style=color:#4070a0;font-style:italic>
</span></code></pre></div><h2 id=fin class=anchor-link><a href=#fin>Fin</a></h2><p>That&rsquo;s it, the workflow was successful I&rsquo;m done! that was easy! Ok, I guess I wasn&rsquo;t done, I had final step and being that this was my first github pages deployment, I did not know that I had to enable it and set a source in the repo settings. So I went to my repo in Github clicked the settings cog wheel and scrolled down the find the &ldquo;Github Pages&rdquo; section. What that last step in the workflow is actually doing is it&rsquo;s committing the /public directory I mentioned earlier to a branch on the repo named gh-pages. This branch contains the final deployable product, so I chose that branch as my source, clicked save and Voila! a minute later it showed me a link to my website!</p><p><img src=/blog/start/pages-setting.png alt=config></p><p>The last thing I did was to rename the repository. I had the name set to portfolio, which by default will deploy the site to a url like <username>.github.io/<repo-name>, but after renaming my repository to brentgruber.github.io, it deployed directly to that url, so I could safely set the BaseURL in my project to / and it was able to load all of my content.</p><h2 id=whats-next class=anchor-link><a href=#whats-next>What&rsquo;s next</a></h2><p>Now that I have a reliable deployment I&rsquo;d like to start blogging more actively. I enjoy learning new things and I&rsquo;ve always said that you really know something when you can teach it or explain it well. So that&rsquo;s going to be my goal going forward with this site, is to add more content. I may have some cleaning up to do on mobile, I know my skills section might need some work, so I can dip my toes into HTML a little bit. I&rsquo;d also like to flex the github actions muscles a little more and possibly look into adding some logic so that when I do publish a new blog post it can be automatically added to a dev.to account or posted to my linkedin profile.</p></div><div class=container><hr></div><div class="container has-text-centered top-pad"><a href=#top><i class="fa fa-arrow-up"></i></a></div><div class=container><hr></div><div class=section id=footer><div class="container has-text-centered"><span class=footer-text><a href=https://github.com/victoriadrake/hugo-theme-introduction/><strong>Introduction</strong></a> theme for <a href=http://gohugo.io/>Hugo</a>. Made with <a href=https://victoria.dev><i class="fa fa-heart"></i>and <i class="fa fa-coffee"></i></a>by open source contributors.</span></div></div></div></section><script src=/js/bundle.93c0c6d75acb9f1eb92ca3981b53b0d2bf30b4e42c9afd8646d082a29658b138.js integrity="sha256-k8DG11rLnx65LKOYG1Ow0r8wtOQsmv2GRtCCopZYsTg="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-177330493-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>